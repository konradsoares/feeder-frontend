<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Feeder Control</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h2 { margin-bottom: 10px; }
    button { margin: 5px; padding: 10px 20px; font-size: 16px; }
    input[type="time"] { padding: 5px; margin-right: 10px; }
  </style>
</head>
<body>

  <h2>Feeder Control Panel</h2>

  <div id="status">Loading status...</div>

  <button onclick="toggleMode()">Switch Mode</button>
  <button onclick="triggerManual()" id="manualBtn" disabled>Open/Close Feeder</button>

  <hr>
  <h3>Scheduled Feeding</h3>
  <form onsubmit="addSchedule(event)">
    <input type="time" id="scheduleTime" required>
    <button type="submit">Add Schedule</button>
  </form>

  <ul id="scheduleList"></ul>

  <script>
    const apiBase = 'https://feeder-backend-production.up.railway.app/'; // Replace with Railway URL

    async function fetchStatus() {
      const res = await fetch(`${apiBase}/status`);
      const data = await res.json();

      document.getElementById('status').innerText =
        `Time: ${data.time} | Mode: ${data.mode} | Feeder: ${data.feeder}`;

      document.getElementById('manualBtn').disabled = (data.mode === 'auto');
    }

    async function toggleMode() {
      await fetch(`${apiBase}/mode`, { method: 'POST' });
      fetchStatus();
    }

    async function triggerManual() {
      await fetch(`${apiBase}/manual`, { method: 'POST' });
      fetchStatus();
    }

    async function fetchSchedules() {
      const res = await fetch(`${apiBase}/schedules`);
      const schedules = await res.json();
      const list = document.getElementById('scheduleList');
      list.innerHTML = '';
      schedules.forEach(s => {
        const li = document.createElement('li');
        li.textContent = s.time;
        list.appendChild(li);
      });
    }

    async function addSchedule(e) {
      e.preventDefault();
      const time = document.getElementById('scheduleTime').value;
      await fetch(`${apiBase}/schedules`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ time })
      });
      document.getElementById('scheduleTime').value = '';
      fetchSchedules();
    }

    // Initial load
    fetchStatus();
    fetchSchedules();
    setInterval(fetchStatus, 60000); // Update status every minute
  </script>
</body>
</html>

